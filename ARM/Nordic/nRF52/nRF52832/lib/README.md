# IOsonata Library for nRF52832

This directory contains the Makefile to build the IOsonata library for the Nordic nRF52832 microcontroller.

## Overview

The Makefile builds `libIOsonata_nRF52832.a`, a static library containing:
- Device-specific sources (interrupt vectors, system initialization)
- nRF52 common peripheral drivers (ADC, BLE, UART, SPI, I2C, etc.)
- ARM Cortex-M common sources
- IOsonata core framework (device interfaces, utilities)
- IOsonata modules (sensors, displays, storage, USB, etc.)

## Prerequisites

### Toolchain
- ARM GCC toolchain (arm-none-eabi-gcc)
- GNU Make

### Installation via IOcomposer Installer
The easiest way to set up the development environment is to use the IOcomposer installer:

**macOS:**
```bash
cd IOsonata/Installer
./install_iocdevtools_macos.sh
```

This will:
- Install ARM GCC, RISC-V GCC, and OpenOCD toolchains
- Install Eclipse Embedded CDT IDE
- Clone IOsonata and all required SDKs
- Generate `makefile_path.mk` with all necessary paths

## Building the Library

### Build Variants

Two build variants are supported:
- **Debug**: Unoptimized with debug symbols (`-O0 -g3`)
- **Release**: Optimized for size (`-O3`)

### Build Commands

```bash
# Build Release variant (default)
make

# Build Debug variant
make debug

# Build Release variant (explicit)
make release

# Build specific variant
make VARIANT=Debug
make VARIANT=Release

# Show build configuration
make info

# Show help
make help

# Clean all builds
make clean

# Clean specific variant
make clean_debug
make clean_release
```

## Output

The library will be created in variant-specific directories:
- `Debug/libIOsonata_nRF52832.a` - Debug build
- `Release/libIOsonata_nRF52832.a` - Release build

Object files are stored in:
- `Debug/obj/` - Debug object files
- `Release/obj/` - Release object files

## Using the Library

To use this library in your project:

1. Build the library (Debug or Release variant)
2. Link against the library in your project Makefile:
   ```makefile
   LDFLAGS += -L$(IOSONATA_ROOT)/ARM/Nordic/nRF52/nRF52832/lib/Release
   LDLIBS += -lIOsonata_nRF52832
   ```

3. Include the necessary headers:
   ```makefile
   INCLUDES += -I$(IOSONATA_ROOT)/include
   INCLUDES += -I$(IOSONATA_ROOT)/ARM/include
   INCLUDES += -I$(IOSONATA_ROOT)/ARM/Nordic/nRF52/nRF52832/lib/include
   ```

## Path Configuration

The Makefile automatically includes `makefile_path.mk` from the IOsonata root directory if it exists. This file is generated by the installer and contains all necessary toolchain and SDK paths.

If `makefile_path.mk` doesn't exist (e.g., in a custom development environment), the Makefile falls back to default values:
- Toolchain: Uses standard `arm-none-eabi-*` commands from PATH
- Paths: Calculated relative to the Makefile location

## Target Device

- **MCU**: nRF52832
- **Core**: ARM Cortex-M4F (with hardware FPU)
- **Device variant**: NRF52832_XXAA

## Compiler Flags

### Common Flags (Debug & Release)
- CPU: `-mcpu=cortex-m4 -mthumb -mfloat-abi=hard -mfpu=fpv4-sp-d16`
- Standards: C17 (`-std=c17`), C++17 (`-std=c++17`)
- Optimizations: Function sections, data sections, short enums
- C++ specific: No exceptions, no RTTI, no threadsafe statics

### Debug-specific
- Optimization: `-O0`
- Debug info: `-g3`
- Define: `DEBUG`

### Release-specific
- Optimization: `-O3`
- Define: `NDEBUG`

## Source Files

The library compiles approximately 131 source files from:
- **Device**: 1 file (Vectors_nRF52832.c)
- **nRF52 common**: 13 files (BLE stack, peripherals)
- **ARM common**: 2 files (reset entry, atomic operations)
- **IOsonata core**: 28 files (framework, utilities)
- **IOsonata modules**: 87 files (sensors, displays, storage, etc.)

## Troubleshooting

### "No such file or directory" errors for toolchain
- Ensure ARM GCC toolchain is installed and in PATH
- Or run the IOcomposer installer to set up the environment
- Or set toolchain paths in `makefile_path.mk`

### Missing header files
- Ensure nrfx SDK is cloned in the external directory
- Run the IOcomposer installer to clone all dependencies

### Build errors
- Run `make clean` to remove stale build artifacts
- Verify toolchain version compatibility
- Check that all required SDKs are present

## Additional Information

For more information about IOsonata:
- Main repository: https://github.com/IOsonata/IOsonata
- Documentation: https://github.com/IOsonata/IOsonata/docs

## License

See the LICENSE file in the IOsonata root directory.
